# 운동 종목별 포즈 평가 기준

## 개요
현재 시스템은 MediaPipe를 사용하여 실시간으로 포즈를 인식하고, 각 운동 종목별로 특정 관절 각도와 위치를 기준으로 자세를 평가합니다.

## 평가 기준

### 1. 스쿼트 (Squat)

#### 핵심 평가 기준:
- **무릎 각도** (엉덩이-무릎-발목)
  - 기준: 160도 미만이면 구부린 것으로 인식
  - 완전한 스쿼트: 약 90도 이하
  - 평가: 무릎 각도가 작을수록 더 깊은 스쿼트로 평가

- **엉덩이 깊이** (엉덩이 Y 좌표 변화)
  - 기준: 서 있을 때의 엉덩이 Y 좌표를 기준점으로 설정
  - 깊이 임계값: 0.04 (정규화된 값)
  - 평가: 엉덩이가 기준점보다 0.04 이상 내려가면 깊은 스쿼트로 인식

- **무릎-발목 정렬**
  - 기준: 무릎과 발목의 X 좌표 차이가 30 이하
  - 평가: 무릎이 발끝을 넘지 않도록 정렬되어 있는지 확인
  - 정렬이 안 되면 -25점 감점

#### 상태 머신:
- `standing` → `down` → `standing` (한 사이클 = 1회 카운트)
- down 상태에서 up 상태로 돌아올 때 카운트 증가

#### 점수 계산 (poseAnalyzer):
- **Alignment (정렬)**: 무릎-발목 정렬 확인
- **Range (범위)**: 엉덩이 깊이 확인 (50 이상이면 감점)
- **Overall**: (Alignment + Range) / 2

---

### 2. 푸시업 (Pushup)

#### 핵심 평가 기준:
- **팔꿈치 각도** (어깨-팔꿈치-손목)
  - Up 상태 임계값: 130도 이상 (팔을 뻗은 상태)
  - Down 상태 임계값: 100도 이하 (팔을 구부린 상태)
  - 평가: 양쪽 팔의 평균 각도 사용

- **측면/정면 감지**
  - 기준: 어깨-팔꿈치-손목의 X 좌표 차이로 판단
  - 측면: X 좌표 차이 < 0.5
  - 정면: X 좌표 차이 >= 0.5
  - 측면에서는 한쪽 팔만 보이므로 더 관대한 기준 적용

- **어깨 정렬**
  - 기준: 양쪽 어깨의 Y 좌표 차이가 20 이하
  - 평가: 어깨가 수평으로 맞춰져 있는지 확인
  - 정렬이 안 되면 -20점 감점

- **손목-어깨 거리** (범위 확인)
  - 기준: 손목과 어깨의 Y 좌표 차이가 30 이상
  - 평가: 팔을 충분히 구부렸는지 확인
  - 거리가 30 미만이면 -30점 감점

- **엉덩이 높이**
  - 기준: 어깨와 엉덩이의 Y 좌표 차이가 100 이하
  - 평가: 엉덩이가 너무 높지 않은지 확인
  - 높이 차이가 100 초과면 -15점 감점

#### 상태 머신:
- `up` → `down` → `up` (한 사이클 = 1회 카운트)
- down 상태에서 up 상태로 돌아올 때 카운트 증가

#### 점수 계산 (poseAnalyzer):
- **Alignment (정렬)**: 어깨 정렬, 엉덩이 높이 확인
- **Range (범위)**: 손목-어깨 거리 확인
- **Overall**: (Alignment + Range) / 2

---

### 3. 런지 (Lunge)

#### 핵심 평가 기준:
- **무릎 각도** (앞 무릎 기준)
  - 기준: 120도 미만이면 구부린 것으로 인식
  - 평가: 앞 무릎과 뒷 무릎 중 더 구부러진 쪽 사용

- **엉덩이 깊이** (엉덩이 Y 좌표 변화)
  - 기준: 서 있을 때의 엉덩이 Y 좌표를 기준점으로 설정
  - 깊이 임계값: 0.08 (정규화된 값)
  - 평가: 엉덩이가 기준점보다 0.08 이상 내려가면 깊은 런지로 인식

- **무릎-발목 정렬**
  - 기준: 앞 무릎과 발목의 X 좌표 차이가 20 이하
  - 평가: 앞 무릎이 발끝을 넘지 않도록 정렬되어 있는지 확인
  - 정렬이 안 되면 -20점 감점

- **엉덩이 수평 유지**
  - 기준: 양쪽 엉덩이의 Y 좌표 차이가 15 이하
  - 평가: 엉덩이가 수평으로 유지되는지 확인
  - 차이가 15 초과면 -15점 감점

- **런지 깊이**
  - 기준: 앞 무릎과 뒷 무릎의 각도가 40 이상
  - 평가: 앞 무릎 각도와 뒷 무릎 각도 모두 확인
  - 각도가 40 미만이면 -25점 감점

#### 상태 머신:
- `standing` → `down` → `standing` (한 사이클 = 1회 카운트)
- down 상태에서 up 상태로 돌아올 때 카운트 증가

#### 점수 계산 (poseAnalyzer):
- **Alignment (정렬)**: 무릎-발목 정렬, 엉덩이 수평 확인
- **Range (범위)**: 런지 깊이 확인
- **Overall**: (Alignment + Range) / 2

---

## 공통 평가 요소

### 1. 관절 각도 계산
- 세 점 사이의 각도: `calculateAngle(point1, point2, point3)`
- point1-point2-point3 순서로 각도 계산
- 0-180도 범위

### 2. 스무딩 (Smoothing)
- 각도나 좌표의 히스토리를 유지하여 노이즈 제거
- 최근 5개 값의 평균 사용

### 3. 기준점 설정
- 서 있을 때의 관절 위치를 기준점으로 설정
- 기준점을 기준으로 운동 깊이와 범위 평가

### 4. 상태 머신
- 각 운동은 `standing/up` ↔ `down` 상태를 전환
- down → up 전환 시 카운트 증가

---

## 운동 등록 시 저장할 핵심 데이터

운동 등록 기능에서는 영상 파일을 저장하지 않고, 다음 데이터만 저장합니다:

1. **핵심 포즈 인식값**:
   - 관절 각도 (팔꿈치, 무릎 등)
   - 관절 위치 (키포인트 좌표)
   - 상체각도, 자세 상태 등

2. **설명**: 각 포즈에 대한 텍스트 설명

3. **포즈 수**: 총 포즈 개수

4. **각 포즈별 이미지**: base64 인코딩된 스냅샷

5. **핵심 포즈 설명**: 관절 각도와 자세 상태를 포함한 상세 설명

6. **생성일**: 등록 날짜 및 시간

이 데이터를 통해 나중에 새로운 운동 종목을 추가할 때 기준 포즈 데이터로 활용할 수 있습니다.

